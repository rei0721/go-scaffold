# ADR-001: 技术选型

> 架构决策记录 - 技术栈选择

---

## Purpose

记录项目技术选型的决策过程和理由。

## Scope

项目整体技术栈。

## Status

**Active**

---

## 上下文

需要构建一个生产级别的 Go Web 后端脚手架，要求：

- 高性能、低资源占用
- 清晰的分层架构
- 良好的可维护性和可测试性
- 支持多数据库

---

## 决策

### Web 框架：Gin

**选择**：`github.com/gin-gonic/gin` v1.11.0

**理由**：

- 高性能，基于 httprouter
- 活跃的社区和丰富的中间件生态
- 简洁的 API 设计
- 良好的错误处理机制

**备选方案**：

- Echo - 性能相当，但生态略逊
- Fiber - 基于 fasthttp，API 不兼容标准库

---

### ORM：GORM

**选择**：`gorm.io/gorm` v1.31.1

**理由**：

- Go 生态中最成熟的 ORM
- 支持多数据库（MySQL、PostgreSQL、SQLite）
- 链式调用 API 易于使用
- 支持迁移、钩子、关联

**备选方案**：

- sqlx - 更轻量，但需要手写 SQL
- ent - 代码生成方式，学习曲线较陡

---

### 日志：Zap

**选择**：`go.uber.org/zap` v1.27.1

**理由**：

- 高性能，零内存分配
- 结构化日志
- 支持多级别和多输出

**备选方案**：

- zerolog - 性能相当
- logrus - API 友好但性能较差

---

### 配置：Viper

**选择**：`github.com/spf13/viper` v1.21.0

**理由**：

- 支持多格式（YAML、JSON、TOML、ENV）
- 支持环境变量覆盖
- 支持配置热重载
- 支持远程配置源

**备选方案**：

- envconfig - 仅支持环境变量
- koanf - 更模块化但社区较小

---

### 缓存：go-redis

**选择**：`github.com/redis/go-redis/v9` v9.17.2

**理由**：

- 官方维护的 Redis 客户端
- 类型安全的 API
- 支持连接池和集群

---

### 其他关键依赖

| 库           | 版本    | 用途           |
| ------------ | ------- | -------------- |
| `snowflake`  | v0.3.0  | 分布式 ID 生成 |
| `lumberjack` | v2.2.1  | 日志文件轮转   |
| `go-i18n`    | v2.6.0  | 国际化         |
| `ants`       | v2.11.4 | 协程池         |

---

## 后果

### 优点

- 成熟稳定的技术栈
- 丰富的社区资源
- 良好的性能表现

### 缺点

- GORM 可能有 N+1 查询问题（需注意优化）
- Viper 配置文件较大

---

## Evidence

- 依赖定义：[go.mod](../go.mod)

## Related

- [架构概述](overview.md)

## Changelog

| 日期       | 变更     |
| ---------- | -------- |
| 2026-01-14 | 初始创建 |
