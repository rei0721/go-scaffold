---
name: changelog-recording
description: 在 docs/ 目录下记录项目变更日志,生成符合 Git 规范的提交文档
---

# 变更日志记录规范

## 概述

本 skill 指导如何在 `docs/` 目录下创建项目变更记录文档,用于跟踪和归档每次重要的代码变更。这些文档将作为 Git commit body 的基础,确保项目历史清晰可追溯。

### 适用场景

- 完成一个完整的功能模块
- 进行重要的重构或优化
- 修复关键 bug
- 更新重要依赖或配置
- 需要详细记录的任何变更

### 不适用场景

- 微小的文本修正
- 格式化代码
- 简单的变量重命名

## 文件结构

```
docs/
├── changelogs/
│   ├── 20260119_203700_新增用户认证模块.md
│   ├── 20260115_143200_重构RBAC权限系统.md
│   └── ...
└── README.md
```

## 文件命名规范

### 格式

```
YYYYMMDD_HHMMSS_变更描述.md
```

### 组成部分

1. **日期部分** (`YYYYMMDD`)
   - 4位年份 + 2位月份 + 2位日期
   - 示例：`20260119`（2026年1月19日）

2. **时间部分** (`HHMMSS`)
   - 2位小时 + 2位分钟 + 2位秒
   - 使用24小时制
   - 示例：`203700`（晚上8点37分）

3. **描述部分** (`变更描述`)
   - 简洁描述本次变更的核心内容
   - 使用中文
   - 不超过20个字符
   - 示例：`新增用户认证模块`、`重构RBAC权限系统`

### 命名示例

```bash
# 好的命名
20260119_203700_新增用户认证模块.md
20260115_143200_重构RBAC权限系统.md
20260112_095430_修复缓存并发问题.md
20260110_161520_升级Gin框架到v2.md

# 避免的命名
2026-01-19_变更.md           # 缺少时间
20260119_更新代码.md          # 缺少时间且描述不清晰
update-auth-module.md        # 不符合格式
```

## 文档内容规范

### 标准模板

```markdown
# 变更标题

## 变更类型

- [ ] 新功能 (Feature)
- [ ] 优化 (Enhancement)
- [ ] 修复 (Fix)
- [ ] 重构 (Refactor)
- [ ] 文档 (Documentation)
- [ ] 测试 (Test)
- [ ] 构建 (Build)
- [ ] 其他 (Other)

## 变更概述

简要描述本次变更的目的和背景（2-3句话）。

## 变更详情

### 新增

- 新增的功能、文件或模块

### 修改

- 修改的内容和原因

### 删除

- 删除的内容和原因

## 技术细节

### 架构变更

如果涉及架构调整,说明新旧架构的差异。

### 关键代码

列出关键的代码文件和核心逻辑：

- `path/to/file.go` - 文件说明
- `path/to/another.go` - 文件说明

### 数据库变更

如果涉及数据库变更,列出具体的表结构或迁移信息。

## 影响范围

### 影响的模块

- 模块A
- 模块B

### 破坏性变更

如有破坏性变更,详细说明：

- 变更内容
- 迁移方案

### 依赖变更

- 新增依赖：`package@version`
- 更新依赖：`package@old-version` -> `package@new-version`
- 移除依赖：`package@version`

## 测试

### 测试覆盖

- [ ] 单元测试
- [ ] 集成测试
- [ ] 手动测试

### 测试结果

简述测试结果或提供测试报告链接。

## Git Commit Message

以下内容可直接用作 Git commit body：
```

变更类型: 简短标题

变更概述：
（2-3句话说明变更的目的和背景）

主要变更：

- 变更点1
- 变更点2
- 变更点3

影响范围：

- 影响的模块或组件

技术细节：

- 关键技术点或实现要点

测试：

- 测试覆盖情况

相关文档：

- docs/changelogs/YYYYMMDD*HHMMSS*变更描述.md

````

## 文档维护

### 文档归档

- 所有变更日志保存在 `docs/changelogs/` 目录
- 按时间顺序自然排列
- 不删除历史记录

### 文档索引

定期更新 `docs/changelogs/README.md`,创建索引：

```markdown
# 变更日志索引

## 2026年1月

- [20260119_203700_新增用户认证模块](./20260119_203700_新增用户认证模块.md)
- [20260115_143200_重构RBAC权限系统](./20260115_143200_重构RBAC权限系统.md)

## 2026年2月

- ...
````

````

## 创建步骤

### 1. 确定变更内容

在开始记录前,确认：

- [ ] 变更已完成并通过测试
- [ ] 变更的影响范围已明确
- [ ] 相关代码已提交到本地仓库

### 2. 生成文件名

```bash
# 获取当前时间（格式：YYYYMMDD_HHMMSS）
# Windows PowerShell
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"

# 构建文件名
$filename = "docs/changelogs/${timestamp}_变更描述.md"
````

### 3. 创建文档

```bash
# 确保目录存在
mkdir -p docs/changelogs

# 创建文件
touch $filename

# 或使用编辑器直接创建
code $filename
```

### 4. 填写内容

1. 复制标准模板
2. 填写变更类型（勾选对应选项）
3. 填写变更概述
4. 详细记录变更详情
5. 说明影响范围
6. 记录测试情况
7. 编写 Git Commit Message

### 5. 审核检查

使用检查清单验证文档质量（见下方检查清单）

### 6. 提交到 Git

```bash
# 添加变更日志文件
git add docs/changelogs/YYYYMMDD_HHMMSS_变更描述.md

# 使用文档中的 commit message
git commit -F docs/changelogs/YYYYMMDD_HHMMSS_变更描述.md

# 或手动编写 commit message,参考文档中的格式
git commit -m "feat: 简短标题" -m "详细说明参见 docs/changelogs/YYYYMMDD_HHMMSS_变更描述.md"
```

## 最佳实践

### 及时记录

- 完成变更后立即记录,趁记忆清晰
- 不要累积多个变更后一次性记录

### 详略得当

- 概述要简洁,3句话以内
- 技术细节要充分,便于后续查阅
- 避免记录无关信息

### 规范用语

- 使用主动语态："新增了XX功能"而非"XX功能被新增"
- 使用完成时态："已实现XX"而非"实现XX"
- 保持专业术语的一致性

### 关联引用

- 如果修复了 issue,在文档中引用 issue 编号
- 如果参考了外部文档,提供链接
- 如果涉及前期变更,引用相关的变更日志

### 结构化表达

- 使用列表而非长段落
- 使用表格展示对比信息
- 使用代码块展示配置或命令

## 工具辅助

### 自动化脚本（可选）

可以创建一个辅助脚本来简化创建过程：

```bash
# scripts/new-changelog.sh
#!/bin/bash

# 获取当前时间
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")

# 提示输入描述
read -p "请输入变更描述: " DESCRIPTION

# 生成文件名
FILENAME="docs/changelogs/${TIMESTAMP}_${DESCRIPTION}.md"

# 创建文件并填充模板
cat > "$FILENAME" << 'EOF'
# 变更标题

## 变更类型

- [ ] 新功能 (Feature)
- [ ] 优化 (Enhancement)
...
（完整模板内容）
EOF

echo "已创建: $FILENAME"
echo "请编辑文件并填写详细内容"

# 打开编辑器
code "$FILENAME"
```

## 常见问题

### Q: 多次小改动如何记录？

A: 如果是相关的小改动,可以合并到一个变更日志中。如果是无关的改动,应分别记录。

### Q: 变更日志和 commit message 的关系？

A: 变更日志是详细的记录,commit message 是摘要。commit message 应包含变更日志的链接。

### Q: 是否需要为每个 commit 都创建变更日志？

A: 不需要。仅为重要的、需要详细记录的变更创建日志。

### Q: 如何处理跨天的开发？

A: 使用完成时的时间,即最终提交时的时间。

## 检查清单

- [ ] 文件名符合 `YYYYMMDD_HHMMSS_变更描述.md` 格式
- [ ] 文件位于 `docs/changelogs/` 目录
- [ ] 已勾选正确的变更类型
- [ ] 变更概述清晰简洁（2-3句话）
- [ ] 变更详情完整（新增/修改/删除）
- [ ] 技术细节充分（关键代码、架构变更等）
- [ ] 影响范围明确（影响的模块、破坏性变更）
- [ ] 测试情况已记录
- [ ] Git Commit Message 已编写
- [ ] 文档语言规范、无错别字
- [ ] 已添加到 Git 仓库
